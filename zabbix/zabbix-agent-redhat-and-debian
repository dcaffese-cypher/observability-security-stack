BASH SCRIPT FOR REDHAT FAMILY

#!/bin/bash

# Check if Zabbix is present
if [ ! -f /etc/zabbix/zabbix_agentd.conf ]; then
    # Determine Rocky Linux version
    ROCKY_VERSION=$(rpm -E %{rhel})

    # Add Zabbix repository
    cat <<EOF > /etc/yum.repos.d/zabbix.repo
[zabbix]
name=Zabbix Official Repository - \$releasever \$basearch
baseurl=http://repo.zabbix.com/zabbix/6.4/rhel/\$releasever/\$basearch/
gpgcheck=0
enabled=1
EOF

    # Replace \$releasever with Rocky Linux version
    sed -i "s/\$releasever/$ROCKY_VERSION/g" /etc/yum.repos.d/zabbix.repo

    # Install Zabbix agent
    yum makecache
    yum install -y zabbix-agent

    # Configure zabbix_agentd.conf
    # Replace ZABBIX_SERVER_IP with your Zabbix server IP or hostname
    # Replace HOSTNAME with your server hostname
    cat <<EOF > /etc/zabbix/zabbix_agentd.conf
PidFile=/run/zabbix/zabbix_agentd.pid
LogFile=/var/log/zabbix/zabbix_agentd.log
LogFileSize=0
Server=ZABBIX_SERVER_IP
ServerActive=ZABBIX_SERVER_IP
Hostname=HOSTNAME
HostnameItem=HOSTNAME
Include=/etc/zabbix/zabbix_agentd.d/*.conf
EOF

    # Ensure Zabbix agent is active and enabled
    systemctl enable zabbix-agent
    systemctl start zabbix-agent

    # Restart zabbix-agent
    systemctl restart zabbix-agent
fi



BASH SCRIPT FOR DEBIAN/UBUNTU

#!/bin/bash

# Check if Zabbix is present
if [ ! -f /etc/zabbix/zabbix_agentd.conf ]; then
    # Install Zabbix agent
    apt-get install -y zabbix-agent

    # Configure zabbix_agentd.conf
    # Replace ZABBIX_SERVER_IP with your Zabbix server IP or hostname
    # Replace HOSTNAME with your server hostname
    cat <<EOF > /etc/zabbix/zabbix_agentd.conf
PidFile=/run/zabbix/zabbix_agentd.pid
LogFile=/var/log/zabbix-agent/zabbix_agentd.log
LogFileSize=0
Server=ZABBIX_SERVER_IP
ServerActive=ZABBIX_SERVER_IP
Hostname=HOSTNAME
HostnameItem=HOSTNAME
EOF

    # Ensure Zabbix agent is active and enabled
    systemctl enable zabbix-agent
    systemctl start zabbix-agent

    # Restart zabbix-agent
    systemctl restart zabbix-agent
fi
